# Migration `20200906141612-todo-parent`

This migration has been generated by Yuji Suzuki at 9/6/2020, 11:16:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Todo" ADD COLUMN "parentId" text   ;

ALTER TABLE "public"."Todo" ADD FOREIGN KEY ("parentId")REFERENCES "public"."Todo"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER INDEX "public"."Account.compoundId" RENAME TO "Account.compoundId_unique"

ALTER INDEX "public"."Account.providerAccountId" RENAME TO "Account.providerAccountId_index"

ALTER INDEX "public"."Account.providerId" RENAME TO "Account.providerId_index"

ALTER INDEX "public"."Account.userId" RENAME TO "Account.userId_index"

ALTER INDEX "public"."Category.ownerId_id_name" RENAME TO "Category.ownerId_id_name_index"

ALTER INDEX "public"."Checkpoint.ownerId_id" RENAME TO "Checkpoint.ownerId_id_index"

ALTER INDEX "public"."Tag.ownerId_id" RENAME TO "Tag.ownerId_id_index"

ALTER INDEX "public"."Todo.ownerId_id" RENAME TO "Todo.ownerId_id_index"

ALTER INDEX "public"."User.email" RENAME TO "User.email_unique"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200808210550-remove-user-avatar-url..20200906141612-todo-parent
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -66,8 +66,11 @@
   category     Category    @relation(fields: [categoryId], references: [id])
   categoryId   String
   checkpoint   Checkpoint? @relation(fields: [checkpointId], references: [id])
   checkpointId String?
+  parentId     String?
+  parent       Todo?       @relation("TodoTree", fields: [parentId], references: [id])
+  children     Todo[]      @relation("TodoTree")
   tags         Tag[]
   status       TodoStatus  @default(TODO)
   archivedAt   DateTime?
```


